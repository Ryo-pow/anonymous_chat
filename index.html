<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>匿名チャット</title>

    <style>
        body {
            font-family: "Helvetica", sans-serif;
            background-color: "f0f2f5";
            padding: 20px;
        }

    #messageInput{
        padding: 10px;
        border: 2px solid #ddd;
        border-radius: 20px;
        width: 250px;
        outline: none;
    }

    button {
        background-color: #0056b3;
        color: white;
        padding: 10px 20px;
        border-radius: 20px;
        cursor: pointer;
    }

    button:hover {
        background-color: #0056b3;
    }

    #messageList{
        list-style: none;
        padding: 0;
    }

    #messageList li {
        background-color: white;
        margin: 10px 0;
        padding: 10px;
        border-radius: 10px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    </style>
</head>
<body>
    <h1>匿名チャット</h1>

    <input type="text" id="messageInput" placeholder="メッセージを入力...">

    <button onclick="sendWhisper()">送信</button>

    <div id="chatLog"></div>

    <ul id="messageList"></ul>

    <script>
        // ここにJavaScript（動き）を書いていきます
        const socket = new WebSocket("ws://127.0.0.1:8000/ws");
        socket.onmessage = function(event) {
            const list = document.getElementById("messageList");
            const li = document.createElement("li");

            li.textContent = "誰かの囁き：" + event.data;
            li.style.color = "blue";
            list.appendChild(li);
        }
    async function sendWhisper() {
        const input = document.getElementById("messageInput");
        const text = input.value;
        if (!text) return;

        try {
            const response = await fetch("http://127.0.0.1:8000/whisper?message=" + encodeURIComponent(text), {
                method: "POST"
        });

            // サーバーからの返事（単なる文字列）を受け取る
            const result = await response.json(); 
            console.log("サーバーの反応:", result);

            // --- 自分の画面に自分の投稿を表示する（DOM操作） ---
            const list = document.getElementById("messageList");
            const li = document.createElement("li");
            
            // 変数「text」（さっき入力欄から取った文字）を直接入れる
            li.textContent = "自分: " + text; 
            
            list.appendChild(li);
            // ------------------------------------------

            input.value = ""; // 入力欄を空にする

    } catch (error) {
        console.error("通信エラー:", error);
    }
}
    </script>
</body>
</html>
